<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kargo FirmalarÄ± & Fiyatlar</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; background: #f7f7fb; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 20px; margin: 16px 0; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
        h2 { margin: 0 0 16px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 12px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #f0f0f0; }
        th { background: #fafafa; font-weight: 600; }
        .btn { padding: 8px 16px; border-radius: 8px; border: 1px solid #e5e7eb; background: #fff; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn:hover { background: #f8fafc; }
        .btn.primary { background: #2563eb; color: #fff; border-color: #2563eb; }
        .btn.primary:hover { background: #1d4ed8; }
        .btn.danger { background: #ef4444; color: #fff; border-color: #ef4444; }
        .btn.danger:hover { background: #dc2626; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .badge.active { background: #d1fae5; color: #065f46; }
        .badge.inactive { background: #fee2e2; color: #991b1b; }
        .json-preview { font-family: monospace; font-size: 12px; background: #f3f4f6; padding: 8px; border-radius: 4px; max-height: 200px; overflow-y: auto; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 4px; font-weight: 500; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; }
        .form-group textarea { min-height: 150px; font-family: monospace; }
        .form-actions { display: flex; gap: 8px; margin-top: 16px; }
        .alert { padding: 12px; border-radius: 8px; margin-bottom: 16px; }
        .alert.success { background: #d1fae5; color: #065f46; }
        .alert.error { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    {% include "_nav.html" %}
    <div class="container">
        <h2>ðŸšš Kargo FirmalarÄ± & Fiyatlar</h2>
        
        <div id="alertContainer"></div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0;">Kargo FirmalarÄ±</h3>
                <div style="display: flex; gap: 8px;">
                    <button onclick="initDefault()" class="btn" style="background: #10b981; color: #fff; border-color: #10b981;">ðŸ”§ VarsayÄ±lanlarÄ± YÃ¼kle (SÃ¼rat)</button>
                    <a href="/admin/shipping-companies/new" class="btn primary">+ Yeni Kargo FirmasÄ±</a>
                </div>
            </div>
            
            {% if companies %}
            <table>
                <thead>
                    <tr>
                        <th>Kod</th>
                        <th>Firma AdÄ±</th>
                        <th>Taban Ãœcret</th>
                        <th>Oranlar</th>
                        <th>Durum</th>
                        <th>Ä°ÅŸlemler</th>
                    </tr>
                </thead>
                <tbody>
                    {% for company in companies %}
                    <tr>
                        <td><strong>{{ company.company_code }}</strong></td>
                        <td>{{ company.company_name }}</td>
                        <td>{{ '%.2f'|format(company.base_fee or 0) }} â‚º</td>
                        <td>
                            {% if company.rates_json %}
                            <div class="json-preview">{{ company.rates_json[:100] }}{% if company.rates_json|length > 100 %}...{% endif %}</div>
                            {% else %}
                            <span style="color: #9ca3af;">Oran tanÄ±mlÄ± deÄŸil</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge {% if company.is_active %}active{% else %}inactive{% endif %}">
                                {% if company.is_active %}Aktif{% else %}Pasif{% endif %}
                            </span>
                        </td>
                        <td>
                            <a href="/admin/shipping-companies/{{ company.id }}" class="btn">DÃ¼zenle</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="color: #6b7280;">HenÃ¼z kargo firmasÄ± tanÄ±mlanmamÄ±ÅŸ.</p>
            {% endif %}
        </div>
        
        <div class="card">
            <h3>Oran FormatÄ±</h3>
            <p>Oranlar JSON formatÄ±nda tanÄ±mlanÄ±r. Her oran bir "tier" (seviye) temsil eder:</p>
            <div class="json-preview">[
  {"max": 500, "fee": 17.81},
  {"max": 1000, "fee": 31.46},
  {"max": 2000, "fee": 58.76},
  {"max": 3000, "fee": 86.06},
  {"max": 4000, "fee": 113.36},
  {"max": 5000, "fee": 140.66},
  {"max": null, "fee_percent": 1.5}
]</div>
            <p style="margin-top: 12px; color: #6b7280; font-size: 14px;">
                <strong>AÃ§Ä±klama:</strong><br>
                - <code>max</code>: Bu seviyeye kadar olan tutarlar iÃ§in geÃ§erli (null ise son seviye)<br>
                - <code>fee</code>: Sabit Ã¼cret (TL)<br>
                - <code>fee_percent</code>: YÃ¼zde bazlÄ± Ã¼cret (Ã¶rn: 1.5 = %1.5)<br>
                - Toplam kargo Ã¼creti = Taban Ãœcret + Seviye Ãœcreti
            </p>
        </div>
    </div>
    
    <script>
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            container.innerHTML = `<div class="alert ${type}">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
        
        async function initDefault() {
            if (!confirm('VarsayÄ±lan SÃ¼rat Kargo firmasÄ±nÄ± eklemek istediÄŸinizden emin misiniz?')) {
                return;
            }
            
            try {
                const res = await fetch('/admin/shipping-companies/init-default', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await res.json();
                
                if (res.ok) {
                    showAlert(data.message || 'SÃ¼rat Kargo baÅŸarÄ±yla eklendi!', 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    showAlert('Hata: ' + (data.detail || data.message || res.status), 'error');
                }
            } catch (e) {
                showAlert('AÄŸ hatasÄ±: ' + e.message, 'error');
            }
        }
    </script>
</body>
</html>

