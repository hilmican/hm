<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AI ile Otomatik BaÄŸlanan GÃ¶nderiler</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
      .meta { color:#6b7280; font-size:12px; }
      .card { border:1px solid #e5e7eb; border-radius:10px; padding:12px; margin:12px 0; background:#fff; }
      .post-card { border:1px solid #fbbf24; border-radius:8px; padding:16px; margin:12px 0; background:#fffbeb; }
      .post-title { font-weight:600; margin-bottom:8px; color:#111827; }
      .actions { display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; }
      button { background:#2563eb; color:#fff; border:none; border-radius:8px; padding:8px 12px; cursor:pointer; font-size:13px; }
      button:hover { background:#1d4ed8; }
      .badge { display:inline-block; padding:4px 8px; border-radius:4px; font-size:11px; font-weight:600; margin-right:6px; }
      .badge-auto { background:#fef3c7; color:#92400e; }
      .badge-product { background:#d1fae5; color:#065f46; }
    </style>
  </head>
  <body>
    {% include "_nav.html" %}
    <h1>ðŸ¤– AI ile Otomatik BaÄŸlanan GÃ¶nderiler</h1>
    
    <div class="meta" style="margin-bottom:12px;">Toplam {{ count }} otomatik baÄŸlanmÄ±ÅŸ gÃ¶nderi bulundu</div>
    
    {% if not posts %}
      <div class="card">
        <p>Otomatik baÄŸlanmÄ±ÅŸ gÃ¶nderi bulunamadÄ±.</p>
      </div>
    {% else %}
      {% for post in posts %}
        <div class="post-card">
          <div class="post-title">
            {% if post.title %}
              {{ post.title[:100] }}{% if post.title|length > 100 %}...{% endif %}
            {% else %}
              (BaÅŸlÄ±k yok)
            {% endif %}
          </div>
          
          <div class="meta" style="margin-top:8px;">
            <span class="badge badge-auto">ðŸ¤– Otomatik BaÄŸlandÄ±</span>
            {% if post.product_id %}
              <span class="badge badge-product">ÃœrÃ¼n: {{ post.product_name or 'ID: ' + post.product_id|string }}</span>
            {% endif %}
            <br>
            GÃ¶nderi ID: {{ post.post_id or post.ig_post_media_id }}<br>
            {% if post.product_id %}Product ID: {{ post.product_id }}<br>{% endif %}
            {% if post.message_id %}Mesaj ID: {{ post.message_id }}<br>{% endif %}
            {% if post.created_at %}OluÅŸturulma: {{ post.created_at }}<br>{% endif %}
            {% if post.url %}<a href="{{ post.url }}" target="_blank" rel="noopener">GÃ¶nderi â†—</a>{% endif %}
          </div>
          
          <div class="actions">
            {% if post.message_id %}
              <form method="post" action="/posts/link/{{ post.message_id }}" style="display:inline;">
                <button type="button" onclick="if(confirm('Bu gÃ¶nderiyi dÃ¼zenlemek iÃ§in manuel baÄŸlama sayfasÄ±na yÃ¶nlendirileceksiniz. Devam edilsin mi?')) { window.location.href='/posts/unlinked?highlight={{ post.post_id }}'; }">DÃ¼zenle / DÃ¼zelt</button>
              </form>
            {% endif %}
            <button type="button" onclick="unlinkPost('{{ post.post_id }}')" style="background:#ef4444;">BaÄŸlantÄ±yÄ± KaldÄ±r</button>
            <a href="/posts/unlinked" style="text-decoration:none;">
              <button class="secondary">TÃ¼m GÃ¶nderiler</button>
            </a>
          </div>
        </div>
      {% endfor %}
    {% endif %}
    
    <script>
      async function unlinkPost(postId) {
        if (!confirm('Bu gÃ¶nderinin Ã¼rÃ¼n baÄŸlantÄ±sÄ±nÄ± kaldÄ±rmak istediÄŸinize emin misiniz? GÃ¶nderi tekrar otomatik baÄŸlanabilir.')) {
          return;
        }
        
        try {
          const response = await fetch(`/posts/unlink/${postId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
          });
          
          if (response.ok) {
            alert('BaÄŸlantÄ± kaldÄ±rÄ±ldÄ±. Sayfa yenilenecek...');
            location.reload();
          } else {
            const error = await response.text();
            alert('Hata: ' + error);
          }
        } catch (error) {
          alert('Hata: ' + error.message);
        }
      }
    </script>
  </body>
</html>

