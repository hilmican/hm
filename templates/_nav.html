<style>
  .topnav { margin:12px 0 18px 0; background:#0f172a; color:#e5e7eb; border-radius:10px; border:1px solid #0b1220; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
  .topnav .inner { display:flex; align-items:center; gap:14px; padding:10px 12px; position:relative; }
  .topnav a { color:#e5e7eb; text-decoration:none; font-size:14px; }
  .topnav .brand { font-weight:600; padding:6px 10px; border-radius:6px; background:#0b1220; border:1px solid rgba(255,255,255,0.06); }
  .menu { display:flex; align-items:center; gap:8px; }
  .menu-item { position:relative; }
  .menu-item > a { display:inline-block; padding:6px 10px; border-radius:6px; }
  .menu-item > a:hover { background:#1f2a44; }
  .submenu { display:none; position:absolute; top:100%; left:0; min-width:200px; background:#0f172a; border:1px solid #0b1220; border-radius:8px; padding:6px; box-shadow:0 8px 24px rgba(0,0,0,0.25); z-index:50; }
  .submenu a { display:block; padding:8px 10px; border-radius:6px; color:#e5e7eb; }
  .submenu a:hover { background:#1f2a44; }
  .menu-item.has-sub:hover .submenu { display:block; }
  .spacer { flex:1; }
  .logout { background:#ef4444; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; }
  @media (max-width: 900px){
    .menu { flex-wrap: wrap; }
  }
</style>
<nav class="topnav">
  <div class="inner">
    <a class="brand" href="/dashboard">{{ t(request, 'nav.brand') }}</a>
    <div class="menu">
      <div class="menu-item has-sub">
        <a href="#">{{ t(request, 'nav.data') }}</a>
        <div class="submenu">
          <a href="/clients/table">{{ t(request, 'nav.clients') }}</a>
          <a href="/items/table">{{ t(request, 'nav.items') }}</a>
          <a href="/products/table">{{ t(request, 'nav.products') }}</a>
          <a href="/inventory/table">{{ t(request, 'nav.inventory') }}</a>
          <a href="/inventory/movements/table">{{ t(request, 'nav.movements') }}</a>
        </div>
      </div>
      <div class="menu-item has-sub">
        <a href="#">{{ t(request, 'nav.sales') }}</a>
        <div class="submenu">
          <a href="/orders/table">{{ t(request, 'nav.orders') }}</a>
          <a href="/payments/table">{{ t(request, 'nav.payments') }}</a>
        </div>
      </div>
      <div class="menu-item has-sub">
        <a href="#">{{ t(request, 'nav.instagram') }}</a>
        <div class="submenu">
          <a href="/ig/inbox">{{ t(request, 'nav.inbox') }}</a>
          <a href="/ig/inbox?has_ad=yes">Inbox ¬∑ Reklamlƒ±</a>
          <a href="/ig/inbox?has_ad=unlinked">Inbox ¬∑ Reklamƒ± √úr√ºne Baƒüla</a>
          <a href="/ig/inbox/ai-replied">ü§ñ AI Cevaplanan Mesajlar</a>
          <a href="/posts/unlinked">G√∂nderileri √úr√ºne Baƒüla</a>
          <a href="/ads/auto-linked">ü§ñ Otomatik Baƒülanan Reklamlar</a>
          <a href="/posts/auto-linked">ü§ñ Otomatik Baƒülanan G√∂nderiler</a>
          <a href="/ig/ai/process">{{ t(request, 'nav.ai_processing') }}</a>
          <a href="/ig/ai/shadow/monitor">{{ t(request, 'nav.ai_shadow_monitor') }}</a>
          <a href="/ig/ai/settings">‚öôÔ∏è AI Cevap Ayarlarƒ±</a>
          <a href="/ig/ai/pretexts">AI Pretext Y√∂netimi</a>
          <a href="/ig/ai/unlinked">{{ t(request, 'nav.unlinked_purchases') }}</a>
          <a href="/ig/ai/link-suggest">{{ t(request, 'nav.link_conversation') }}</a>
          <a href="/ig/debug/env">{{ t(request, 'nav.debug_env') }}</a>
        </div>
      </div>
      <div class="menu-item has-sub">
        <a href="#">{{ t(request, 'nav.import') }}</a>
        <div class="submenu">
          <a href="/mappings/table">{{ t(request, 'nav.mapping') }}</a>
          <a href="/import/map?source=bizim&filename=last">{{ t(request, 'nav.mapping_wizard') }}</a>
          <a href="/reconcile/returns">{{ t(request, 'nav.returns_reconcile') }}</a>
        </div>
      </div>
      <div class="menu-item has-sub">
        <a href="#">{{ t(request, 'nav.reports') }}</a>
        <div class="submenu">
          <a href="/reports/daily">{{ t(request, 'nav.daily') }}</a>
          <a href="/costs">{{ t(request, 'nav.costs') }}</a>
        </div>
      </div>
      <div class="menu-item has-sub">
        <a href="#">{{ t(request, 'nav.admin') }}</a>
        <div class="submenu">
          <a href="/noc">{{ t(request, 'nav.noc') }}</a>
          <a href="/admin/status">{{ t(request, 'nav.system_status') }}</a>
          <a href="/admin/health">{{ t(request, 'nav.health_json') }}</a>
          <a href="/admin/version">{{ t(request, 'nav.version_json') }}</a>
          <a href="/admin/fix/message-timestamps">{{ t(request, 'nav.fix_message_ts') }}</a>
          <a href="/admin/reimport/raw-json">{{ t(request, 'nav.reimport_raw_json') }}</a>
          <a href="/admin/debug/jobs?kind=ingest">{{ t(request, 'nav.jobs_ingest') }}</a>
          <a href="/admin/debug/attachments">{{ t(request, 'nav.attachments_json') }}</a>
          <a href="/admin/debug/conversations">{{ t(request, 'nav.conversations_json') }}</a>
          <a href="#" id="invalidateCacheLink">{{ t(request, 'nav.cache_invalidate') }}</a>
        </div>
      </div>
      <div class="menu-item has-sub">
        <a href="#">{{ t(request, 'nav.legal') }}</a>
        <div class="submenu">
          <a href="/privacy">{{ t(request, 'nav.privacy') }}</a>
          <a href="/terms">{{ t(request, 'nav.terms') }}</a>
          <a href="/data_deletion">{{ t(request, 'nav.data_deletion') }}</a>
        </div>
      </div>
      <div class="menu-item has-sub">
        <a href="#">{{ t(request, 'nav.language') }}</a>
        <div class="submenu">
          <a href="#" onclick="return setLang('tr')">{{ t(request, 'lang.turkish') }}</a>
          <a href="#" onclick="return setLang('en')">{{ t(request, 'lang.english') }}</a>
        </div>
      </div>
    </div>
    <div class="spacer"></div>
    <button id="logoutBtn" class="logout" type="button">{{ t(request, 'nav.logout') }}</button>
  </div>
  
</nav>
<script>
  (function(){
    const MSG_LOGOUT_ERROR = "{{ t(request, 'nav.logout_error') }}";
    const MSG_CACHE_CLEARED = "{{ t(request, 'nav.cache_cleared') }}";
    const MSG_CLEAR_ERROR = "{{ t(request, 'nav.clear_error') }}";
    const btn = document.getElementById('logoutBtn');
    if (btn) {
      btn.addEventListener('click', async ()=>{
        try { await fetch('/auth/logout', { method: 'POST' }); location.href = '/auth/login'; } catch(e){ alert('√áƒ±kƒ±≈ü hatasƒ±'); }
      });
    }
    const inv = document.getElementById('invalidateCacheLink');
    if (inv) {
      inv.addEventListener('click', async (e)=>{
        e.preventDefault();
        try {
          const res = await fetch('/admin/cache/invalidate', { method: 'POST' });
          let msg = MSG_CACHE_CLEARED;
          try { const j = await res.json(); if (!res.ok) msg = (j && (j.detail||j.error)) ? (MSG_CLEAR_ERROR + ': ' + (j.detail||j.error)) : (MSG_CLEAR_ERROR + ': ' + res.status); } catch(_e) {}
          alert(msg);
        } catch(e){ alert(MSG_CLEAR_ERROR); }
      });
    }
    window.setLang = async function(lang){
      try {
        const res = await fetch('/i18n/set', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({ lang })
        });
        // Always reload to reflect new language
        location.reload();
      } catch(e){
        // ignore
      }
      return false;
    }
  })();
</script>


