<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Reklamı Ürüne Bağla</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
      .meta { color:#6b7280; font-size:12px; }
      .card { border:1px solid #e5e7eb; border-radius:10px; padding:12px; margin:12px 0; background:#f9fafb; }
      input { padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; }
      label { display:block; font-size:13px; color:#111827; margin-bottom:6px; }
      .row { display:flex; gap:8px; align-items:center; }
      button { background:#2563eb; color:#fff; border:none; border-radius:8px; padding:10px 12px; cursor:pointer; }
      a { color:#2563eb; text-decoration:none; }
    </style>
  </head>
  <body>
    {% include "_nav.html" %}
    <h1>Reklamı Ürüne Bağla</h1>
    <div class="card">
      <div class="row">
        {% if ad and ad.image_url %}
          <img src="{{ ad.image_url }}" alt="ad" style="width:96px;height:96px;object-fit:cover;border-radius:8px;border:1px solid #e5e7eb" />
        {% endif %}
        <div>
          <div><strong>Ad ID:</strong> {{ ad.ad_id or '-' }}</div>
          <div><strong>Başlık:</strong> {{ ad.name or ad.title or '-' }}</div>
          {% if ad.link %}<div><a href="{{ ad.link }}" target="_blank" rel="noopener">Ads link ↗</a></div>{% endif %}
          {% if ad.fetch_status %}<div class="meta">Durum: {{ ad.fetch_status }} {% if ad.updated_at %}· {{ ad.updated_at }}{% endif %}</div>{% endif %}
          {% if ad.fetch_error %}<div class="meta">Hata: {{ ad.fetch_error }}</div>{% endif %}
        </div>
      </div>
    </div>
    <div class="card">
      <h3 style="margin:0 0 8px 0;">Mevcut Bağlantı</h3>
      <div class="meta">
        Product ID: {{ mapping.product_id or '-' }}
        {% if mapping.sku %} · SKU (eski): {{ mapping.sku }}{% endif %}
        {% if not mapping.product_id %}
          · <span style="color:#b91c1c;">Bu reklam henüz bir ürüne bağlı değil.</span>
        {% else %}
          · <span style="color:#16a34a;">Bu reklam bir ürüne bağlı.</span>
        {% endif %}
      </div>
    </div>
    <form method="post" action="/ads/{{ ad_id }}/save" style="margin-top:12px;">
      <div style="display:grid; gap:12px; max-width:420px;">
        <div>
          <label>Ürün Seçimi</label>
          <select name="product_id" style="width:100%; padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px;">
            <option value="">Ürün seçiniz</option>
            {% for p in products or [] %}
              <option value="{{ p.id }}" {% if mapping.product_id and p.id == mapping.product_id %}selected{% endif %}>
                {{ p.name }}
              </option>
            {% endfor %}
          </select>
          <div class="meta" style="margin-top:4px;">Bu reklamı bağlamak istediğiniz ürünü seçin. Beden / renk gibi varyantlar bu sayfada ayrıştırılmaz.</div>
        </div>
        <div>
          <button type="submit">Kaydet</button>
          {% if ad and ad.ad_id %}<a style="margin-left:8px" href="/ig/inbox?q={{ ad.ad_id }}">İnboxta ara</a>{% endif %}
        </div>
      </div>
    </form>
  </body>
  </html>


