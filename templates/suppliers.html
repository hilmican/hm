<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cari Hesaplar</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
      h1 { margin-bottom: 12px; }
      .btn { background:#2563eb; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer }
      .btn-secondary { background:#6b7280; }
      .btn-success { background:#10b981; }
      .btn-danger { background:#dc2626; }
      input[type=text], input[type=number] { padding:6px 8px; border:1px solid #ddd; border-radius:6px; }
      table { width: 100%; border-collapse: collapse; margin-top: 16px; }
      th, td { padding: 12px; border-bottom: 1px solid #f0f0f0; text-align: left; font-size: 14px; }
      th { background: #fafafa; position: sticky; top: 0; font-weight: 600; }
      .card { border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; background:#fff; margin-bottom: 18px; }
      .card h2 { margin: 0; padding: 12px 16px; background: #f9fafb; border-bottom: 1px solid #e5e7eb; font-size: 16px; }
      .card .body { padding: 12px 16px; }
      .row { display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end; }
      .field { display:block; }
      .field label { display:block; font-size:12px; color:#374151; margin-bottom:4px; }
      .muted { color:#6b7280; font-size:12px; }
      .positive { color:#10b981; font-weight:600; }
      .negative { color:#dc2626; font-weight:600; }
      .neutral { color:#6b7280; }
      .totals-row { background:#f9fafb; font-weight:700; }
      .totals-row th, .totals-row td { border-top:2px solid #e5e7eb; }
      
      /* Mobile responsive styles */
      @media (max-width: 768px) {
        body { margin: 12px; }
        h1 { font-size: 20px; }
        .row { flex-direction: column; align-items: stretch; }
        .field { width: 100%; }
        input[type=text], input[type=number] { width: 100%; box-sizing: border-box; }
        table { font-size: 12px; }
        th, td { padding: 8px 6px; }
        .card .body { padding: 8px 12px; }
        .card h2 { font-size: 14px; padding: 10px 12px; }
      }
      
      @media (max-width: 480px) {
        body { margin: 8px; }
        h1 { font-size: 18px; margin-bottom: 8px; }
        table { display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        th, td { font-size: 11px; padding: 6px 4px; white-space: nowrap; }
        .card { margin-bottom: 12px; }
        .btn { padding: 8px 12px; font-size: 14px; width: 100%; text-align: center; margin-bottom: 8px; }
      }
    </style>
  </head>
  <body>
    {% include "_nav.html" %}
    <h1>Cari Hesaplar</h1>

    <div class="card">
      <h2>Yeni Cari Ekle</h2>
      <div class="body">
        <form method="post" action="/suppliers/add" class="row">
          <div class="field">
            <label>İsim <span style="color:red;">*</span></label>
            <input type="text" name="name" required placeholder="Cari adı" />
          </div>
          <div class="field">
            <label>Telefon</label>
            <input type="text" name="phone" placeholder="Telefon numarası" />
          </div>
          <div class="field">
            <label>Adres</label>
            <input type="text" name="address" placeholder="Adres" />
          </div>
          <div class="field">
            <label>Vergi No</label>
            <input type="text" name="tax_id" placeholder="Vergi numarası" />
          </div>
          <div style="align-self:flex-end">
            <button class="btn" type="submit">Ekle</button>
          </div>
        </form>
      </div>
    </div>

    <div class="card">
      <h2>Cari Listesi</h2>
      <div class="body" style="padding:0">
        <table>
          <thead>
            <tr>
              <th>İsim</th>
              <th>Telefon</th>
              <th>Adres</th>
              <th>Toplam Borç</th>
              <th>Kapatılan</th>
              <th>Toplam Ödeme</th>
              <th>Kalan Borç</th>
              <th>İşlemler</th>
            </tr>
          </thead>
          <tbody>
            {% for data in supplier_data %}
            <tr>
              <td><strong>{{ data.supplier.name }}</strong></td>
              <td>{{ data.supplier.phone or '-' }}</td>
              <td>{{ data.supplier.address or '-' }}</td>
              <td class="negative">{{ '%.2f'|format(data.total_debt) }} ₺</td>
              <td class="positive">{{ '%.2f'|format(data.total_closed) }} ₺</td>
              <td class="positive">{{ '%.2f'|format(data.total_payment) }} ₺</td>
              <td class="{% if data.remaining_debt > 0 %}negative{% elif data.remaining_debt < 0 %}positive{% else %}neutral{% endif %}">
                {{ '%.2f'|format(data.remaining_debt) }} ₺
              </td>
              <td>
                <a href="/suppliers/{{ data.supplier.id }}" class="btn btn-secondary" style="text-decoration:none; display:inline-block;">Detay</a>
              </td>
            </tr>
            {% endfor %}
            {% if not supplier_data %}
            <tr>
              <td colspan="8" style="text-align:center; color:#6b7280; padding:24px;">
                Henüz cari hesap eklenmemiş.
              </td>
            </tr>
            {% endif %}
          </tbody>
          <tfoot>
            <tr class="totals-row">
              <th colspan="3">Toplam</th>
              <th class="negative">{{ '%.2f'|format(totals.total_debt) }} ₺</th>
              <th class="positive">{{ '%.2f'|format(totals.total_closed) }} ₺</th>
              <th class="positive">{{ '%.2f'|format(totals.total_payment) }} ₺</th>
              <th class="{% if totals.remaining_debt > 0 %}negative{% elif totals.remaining_debt < 0 %}positive{% else %}neutral{% endif %}">
                {{ '%.2f'|format(totals.remaining_debt) }} ₺
              </th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </body>
</html>

