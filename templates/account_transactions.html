<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ account.name }} - İşlemler</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
      h1 { margin-bottom: 12px; }
      .toolbar { display:flex; gap:12px; align-items:flex-end; margin:14px 0; flex-wrap:wrap; }
      .btn { background:#2563eb; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer }
      input[type=date] { padding:6px 8px; border:1px solid #ddd; border-radius:6px; }
      table { width: 100%; border-collapse: collapse; margin-top: 18px; }
      th, td { padding: 8px 12px; border-bottom: 1px solid #f0f0f0; text-align: left; font-size: 14px; }
      th { background: #fafafa; position: sticky; top: 0; }
      .card { border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; background:#fff; margin-top: 18px; }
      .card h2 { margin: 0; padding: 12px 16px; background: #f9fafb; border-bottom: 1px solid #e5e7eb; font-size: 16px; }
      .card .body { padding: 12px 16px; }
      .balance-positive { color: #059669; font-weight: 600; }
      .balance-negative { color: #dc2626; font-weight: 600; }
      .balance-zero { color: #6b7280; }
      .income-row { background: #f0fdf4; }
      .expense-row { background: #fef2f2; }
      .summary-box { background: #f0f9ff; padding: 16px; border-radius: 6px; margin-bottom: 18px; }
      .summary-box strong { color: #1e40af; }
      a { color: #2563eb; text-decoration: none; }
      a:hover { text-decoration: underline; }
      
      /* Mobile responsive styles */
      @media (max-width: 768px) {
        body { margin: 12px; }
        h1 { font-size: 20px; }
        .toolbar { flex-direction: column; align-items: stretch; }
        .toolbar > div { width: 100%; }
        .toolbar input[type="date"] { width: 100%; }
        .summary-box { padding: 12px; font-size: 14px; }
        table { font-size: 12px; }
        th, td { padding: 8px 6px; }
        .card .body { padding: 8px 12px; }
        .card h2 { font-size: 14px; padding: 10px 12px; }
      }
      
      @media (max-width: 480px) {
        body { margin: 8px; }
        h1 { font-size: 18px; margin-bottom: 8px; }
        .summary-box { padding: 10px; font-size: 12px; }
        table { display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        th, td { font-size: 11px; padding: 6px 4px; white-space: nowrap; }
        .card { margin-top: 12px; }
        .btn { padding: 8px 12px; font-size: 14px; width: 100%; text-align: center; margin-bottom: 8px; }
      }
    </style>
  </head>
  <body>
    {% include "_nav.html" %}
    <h1>{{ account.name }} - İşlem Geçmişi</h1>

    <div class="summary-box">
      <strong>Hesap Bilgileri:</strong><br>
      Tür: {{ account.type }}<br>
      {% if account.iban %}IBAN: {{ account.iban }}<br>{% endif %}
      Başlangıç Bakiyesi: {{ '%.2f'|format(account.initial_balance or 0) }} ₺<br>
      <strong style="font-size: 18px;">Güncel Bakiye: 
        <span class="{% if current_balance > 0 %}balance-positive{% elif current_balance < 0 %}balance-negative{% else %}balance-zero{% endif %}">
          {{ '%.2f'|format(current_balance) }} ₺
        </span>
      </strong>
    </div>

    <form class="toolbar" method="get" action="/accounts/{{ account.id }}/transactions">
      <div>
        <label style="display:block;font-size:12px;color:#374151">Başlangıç</label>
        <input type="date" name="start" value="{{ start.isoformat() if start else '' }}" />
      </div>
      <div>
        <label style="display:block;font-size:12px;color:#374151">Bitiş</label>
        <input type="date" name="end" value="{{ end.isoformat() if end else '' }}" />
      </div>
      <div>
        <button class="btn" type="submit">Filtrele</button>
      </div>
      <div>
        <a href="/accounts/table" class="btn" style="display:inline-block;text-decoration:none;">Hesap Listesine Dön</a>
      </div>
    </form>

    <div class="card">
      <h2>İşlemler</h2>
      <div class="body" style="padding:0">
        <table>
          <thead>
            <tr>
              <th>Tarih</th>
              <th>Tür</th>
              <th>Gider Türü</th>
              <th>Cari</th>
              <th>Açıklama</th>
              <th>Tutar</th>
              <th>Bakiye</th>
            </tr>
          </thead>
          <tbody>
            {% for txn in transactions %}
            <tr class="{{ 'income-row' if txn.type == 'income' else 'expense-row' }}">
              <td>{{ txn.date }}</td>
              <td>{{ 'Gelir' if txn.type == 'income' else 'Gider' }}</td>
              <td>{{ txn.cost_type_name if txn.cost_type_name else '-' }}</td>
              <td>{{ txn.supplier_name if txn.supplier_name else '-' }}</td>
              <td>{{ txn.description }}</td>
              <td class="{% if txn.amount > 0 %}balance-positive{% else %}balance-negative{% endif %}">
                {{ '%.2f'|format(txn.amount) }} ₺
              </td>
              <td class="{% if txn.running_balance > 0 %}balance-positive{% elif txn.running_balance < 0 %}balance-negative{% else %}balance-zero{% endif %}">
                {{ '%.2f'|format(txn.running_balance) }} ₺
              </td>
            </tr>
            {% endfor %}
            {% if not transactions %}
            <tr>
              <td colspan="7" style="text-align: center; color: #6b7280; padding: 24px;">
                Bu dönemde işlem bulunamadı.
              </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>

