<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AI Cevap AyarlarÄ±</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
      .field { margin-bottom: 16px; }
      label { display:block; font-weight:600; margin-bottom:8px; color:#111827; }
      input[type="checkbox"] { width:20px; height:20px; margin-right:8px; }
      button { background:#2563eb; color:#fff; border:none; border-radius:8px; padding:10px 14px; cursor:pointer; margin-top:8px; }
      .meta { color:#6b7280; font-size:12px; margin-top:6px; }
      .box { border:1px solid #e5e7eb; border-radius:10px; padding:16px; margin-bottom:16px; max-width:600px; }
      .warning { background:#fef3c7; border:1px solid #f59e0b; border-radius:8px; padding:12px; margin-bottom:16px; }
    </style>
  </head>
  <body>
    {% include "_nav.html" %}
    <h1>AI Cevap AyarlarÄ±</h1>
    
    <div class="warning">
      <strong>âš ï¸ Ã–nemli:</strong> GÃ¶lge cevaplar (shadow replies) her zaman Ã§alÄ±ÅŸÄ±r ve test edilir. 
      Bu ayarlar sadece AI'Ä±n gerÃ§ekten mÃ¼ÅŸterilere cevap gÃ¶ndermesini kontrol eder.
    </div>

    {% if model_refresh_msg %}
    <div class="warning" style="background:#ecfdf5; border-color:#10b981; color:#065f46;">
      {{ model_refresh_msg }}
    </div>
    {% endif %}

    <form method="post" action="/ig/ai/settings/refresh-models" style="margin-bottom:16px; max-width:600px;">
      <button type="submit" style="background:#059669;">AI Model listesini OpenAI'den gÃ¼ncelle</button>
      <div class="meta">Yeni modeller whitelist'e eklenir, OpenAI'de silinenler listeden Ã§Ä±kar.</div>
    </form>

    <form method="post" action="/ig/ai/settings/save">
      <div class="box">
        <div class="field">
          <label>
            <input type="checkbox" 
                   name="ai_reply_sending_enabled" 
                   value="1" 
                   {% if ai_reply_sending_enabled %}checked{% endif %} />
            Global AI Cevap GÃ¶nderme Aktif
          </label>
          <div class="meta">
            TÃ¼m Ã¼rÃ¼nler iÃ§in AI'Ä±n gerÃ§ekten cevap gÃ¶ndermesine izin ver. 
            Bu kapalÄ±ysa, hiÃ§bir Ã¼rÃ¼n iÃ§in AI cevap gÃ¶ndermez (gÃ¶lge cevaplar yine de Ã§alÄ±ÅŸÄ±r).
          </div>
        </div>
        <div class="field">
          <label for="ai_model">AI Model (GerÃ§ek Cevaplar)</label>
          <select name="ai_model" id="ai_model" style="width:100%; max-width:300px; padding:8px; border:1px solid #d1d5db; border-radius:6px; font-size:14px;">
            {% if model_groups %}
              {% for label, bucket in model_groups.items() %}
                <optgroup label="{{ label }}">
                  {% for model in bucket %}
                    <option value="{{ model }}" {% if ai_model == model %}selected{% endif %}>{{ model }}</option>
                  {% endfor %}
                </optgroup>
              {% endfor %}
            {% else %}
              <option value="{{ ai_model }}" selected>{{ ai_model }}</option>
            {% endif %}
          </select>
          <div class="meta">
            MÃ¼ÅŸterilere gÃ¶nderilecek gerÃ§ek AI yanÄ±tlarÄ± iÃ§in kullanÄ±lacak OpenAI modeli.
          </div>
        </div>
        <div class="field">
          <label for="ai_shadow_model">GÃ¶lge Cevaplar Modeli (Shadow Replies)</label>
          <select name="ai_shadow_model" id="ai_shadow_model" style="width:100%; max-width:300px; padding:8px; border:1px solid #d1d5db; border-radius:6px; font-size:14px;">
            {% if model_groups %}
              {% for label, bucket in model_groups.items() %}
                <optgroup label="{{ label }}">
                  {% for model in bucket %}
                    <option value="{{ model }}" {% if ai_shadow_model == model %}selected{% endif %}>{{ model }}</option>
                  {% endfor %}
                </optgroup>
              {% endfor %}
            {% else %}
              <option value="{{ ai_shadow_model }}" selected>{{ ai_shadow_model }}</option>
            {% endif %}
          </select>
          <div class="meta">
            GÃ¶lge cevaplar (test/taslak cevaplar) iÃ§in kullanÄ±lacak OpenAI modeli. Bu cevaplar mÃ¼ÅŸterilere gÃ¶nderilmez, sadece gÃ¶zden geÃ§irme iÃ§in Ã¼retilir.
          </div>
        </div>
        <div class="field">
          <label for="ai_shadow_temperature">Model Parametreleri (Temperature)</label>
          <input type="number"
                 name="ai_shadow_temperature"
                 id="ai_shadow_temperature"
                 step="0.1"
                 min="0"
                 max="2"
                 value="{{ '%.2f'|format(ai_shadow_temperature or 0.1) }}"
                 style="width:100%; max-width:160px; padding:8px; border:1px solid #d1d5db; border-radius:6px; font-size:14px;" />
          <div class="meta">
            BazÄ± yeni modeller yalnÄ±zca temperature=1 deÄŸerini kabul eder. Ä°htiyaca gÃ¶re 0 ile 2 arasÄ±nda ayarlayabilirsiniz.
          </div>
          <label style="display:flex; align-items:center; gap:6px; margin-top:8px;">
            <input type="checkbox"
                   name="ai_shadow_temp_opt_out"
                   id="ai_shadow_temp_opt_out"
                   value="1"
                   {% if ai_shadow_temp_opt_out %}checked{% endif %} />
            Temperature parametresini API'ye gÃ¶nderme (model varsayÄ±lanÄ±nÄ± kullan)
          </label>
          <div class="meta">
            GPT-5 gibi bazÄ± modeller parametre kabul etmiyorsa bu seÃ§eneÄŸi iÅŸaretleyin.
          </div>
        </div>
        <button type="submit">AyarlarÄ± Kaydet</button>
      </div>
    </form>

    <div class="box">
      <h3 style="margin:0 0 8px 0">ÃœrÃ¼n BazlÄ± Kontrol</h3>
      <div class="meta" style="margin-bottom:8px;">
        Her Ã¼rÃ¼n iÃ§in ayrÄ± ayrÄ± AI cevap gÃ¶ndermeyi aÃ§Ä±p kapatabilirsiniz. 
        ÃœrÃ¼n bazlÄ± ayarlarÄ± yÃ¶netmek iÃ§in:
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <a href="/products/table" style="background:#2563eb; color:#fff; padding:8px 12px; border-radius:6px; text-decoration:none; display:inline-block;">
          ğŸ“¦ ÃœrÃ¼nler Tablosu
        </a>
        <div class="meta" style="align-self:center;">
          â†’ ÃœrÃ¼nler tablosunda "AI TalimatlarÄ±" linkine tÄ±klayarak her Ã¼rÃ¼n iÃ§in "AI Cevap GÃ¶nderme Aktif" 
          seÃ§eneÄŸini aÃ§Ä±p kapatabilirsiniz.
        </div>
      </div>
    </div>
  </body>
  <script>
    (function(){
      const checkbox = document.getElementById('ai_shadow_temp_opt_out');
      const input = document.getElementById('ai_shadow_temperature');
      if(!checkbox || !input) return;
      const sync = () => {
        const disabled = checkbox.checked;
        input.disabled = disabled;
        input.style.opacity = disabled ? 0.5 : 1;
      };
      checkbox.addEventListener('change', sync);
      sync();
    })();
  </script>
</html>

